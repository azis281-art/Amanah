import React, { useState, useEffect } from 'react';
import { BookOpen, CheckCircle, XCircle, Star, HelpCircle, ArrowRight, Menu, Home, Book, Activity, Award } from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('home');
  const [sidebarOpen, setSidebarOpen] = useState(false);

  // Close sidebar on mobile when tab changes
  useEffect(() => {
    setSidebarOpen(false);
  }, [activeTab]);

  const renderContent = () => {
    switch (activeTab) {
      case 'home': return <HomeSection changeTab={setActiveTab} />;
      case 'materi-jujur': return <MateriJujur />;
      case 'materi-amanah': return <MateriAmanah />;
      case 'studi-kasus': return <StudiKasus />;
      case 'kuis': return <Kuis />;
      default: return <HomeSection changeTab={setActiveTab} />;
    }
  };

  return (
    <div className="min-h-screen bg-emerald-50 font-sans text-gray-800 flex flex-col md:flex-row overflow-hidden">
      {/* Mobile Header */}
      <div className="md:hidden bg-emerald-700 text-white p-4 flex justify-between items-center shadow-md z-20">
        <h1 className="font-bold text-lg">PAI Kelas 8</h1>
        <button onClick={() => setSidebarOpen(!sidebarOpen)}>
          <Menu />
        </button>
      </div>

      {/* Sidebar Navigation */}
      <aside className={`
        fixed md:static inset-y-0 left-0 z-10 w-64 bg-white shadow-xl transform transition-transform duration-300 ease-in-out md:transform-none border-r border-emerald-100
        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
      `}>
        <div className="p-6 bg-emerald-600 text-white">
          <h2 className="text-2xl font-bold flex items-center gap-2">
            <BookOpen size={24} />
            Modul PAI
          </h2>
          <p className="text-emerald-100 text-sm mt-2">Bab: Lebih Dekat Kepada Allah dengan Jujur & Amanah</p>
        </div>
        
        <nav className="p-4 space-y-2">
          <NavButton id="home" active={activeTab} onClick={setActiveTab} icon={<Home size={18} />} label="Beranda" />
          <div className="pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Materi</div>
          <NavButton id="materi-jujur" active={activeTab} onClick={setActiveTab} icon={<Book size={18} />} label="Perilaku Jujur" />
          <NavButton id="materi-amanah" active={activeTab} onClick={setActiveTab} icon={<Book size={18} />} label="Perilaku Amanah" />
          <div className="pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Aktivitas</div>
          <NavButton id="studi-kasus" active={activeTab} onClick={setActiveTab} icon={<Activity size={18} />} label="Studi Kasus" />
          <NavButton id="kuis" active={activeTab} onClick={setActiveTab} icon={<Award size={18} />} label="Kuis Interaktif" />
        </nav>
      </aside>

      {/* Main Content Area */}
      <main className="flex-1 overflow-y-auto p-4 md:p-8 relative">
        <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-sm min-h-[80vh] p-6 md:p-10 border border-emerald-50">
          {renderContent()}
        </div>
        
        {/* Overlay for mobile sidebar */}
        {sidebarOpen && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-0 md:hidden"
            onClick={() => setSidebarOpen(false)}
          ></div>
        )}
      </main>
    </div>
  );
};

const NavButton = ({ id, active, onClick, icon, label }) => (
  <button
    onClick={() => onClick(id)}
    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-all duration-200
      ${active === id 
        ? 'bg-emerald-100 text-emerald-800 font-semibold border-r-4 border-emerald-600' 
        : 'text-gray-600 hover:bg-gray-50 hover:text-emerald-600'
      }`}
  >
    {icon}
    <span>{label}</span>
  </button>
);

/* --- Components Content --- */

const HomeSection = ({ changeTab }) => (
  <div className="space-y-6 text-center py-10">
    <div className="w-24 h-24 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
      <Star size={48} className="text-emerald-600" />
    </div>
    <h1 className="text-4xl font-bold text-gray-800 mb-2">Selamat Datang!</h1>
    <h2 className="text-xl text-emerald-600 font-medium">Modul Pembelajaran PAI Kelas 8</h2>
    <p className="text-gray-600 max-w-lg mx-auto leading-relaxed">
      Modul interaktif ini akan membantumu memahami pentingnya perilaku 
      <span className="font-bold text-gray-800"> Jujur</span> dan 
      <span className="font-bold text-gray-800"> Amanah</span> dalam kehidupan sehari-hari 
      sebagai cerminan orang yang beriman.
    </p>

    <div className="grid md:grid-cols-2 gap-4 mt-10 text-left">
      <div className="p-5 border border-emerald-100 rounded-xl bg-emerald-50 hover:shadow-md transition-shadow cursor-pointer" onClick={() => changeTab('materi-jujur')}>
        <h3 className="font-bold text-lg mb-2 flex items-center gap-2 text-emerald-800">
          <Book size={20} /> Pelajari Materi
        </h3>
        <p className="text-sm text-gray-600">Pahami pengertian, dalil naqli, dan contoh perilaku jujur serta amanah.</p>
      </div>
      <div className="p-5 border border-emerald-100 rounded-xl bg-emerald-50 hover:shadow-md transition-shadow cursor-pointer" onClick={() => changeTab('studi-kasus')}>
        <h3 className="font-bold text-lg mb-2 flex items-center gap-2 text-emerald-800">
          <Activity size={20} /> Uji Pemahaman
        </h3>
        <p className="text-sm text-gray-600">Latih dirimu dengan studi kasus nyata dan kuis interaktif.</p>
      </div>
    </div>
    
    <button 
      onClick={() => changeTab('materi-jujur')}
      className="mt-8 px-8 py-3 bg-emerald-600 text-white rounded-full font-semibold hover:bg-emerald-700 transition-colors inline-flex items-center gap-2"
    >
      Mulai Belajar <ArrowRight size={18} />
    </button>
  </div>
);

const MateriJujur = () => (
  <div className="space-y-8 animate-fadeIn">
    <header className="border-b pb-4 border-gray-200">
      <h2 className="text-3xl font-bold text-emerald-800">Perilaku Jujur</h2>
      <p className="text-gray-500 mt-1">Induk dari sifat-sifat terpuji (Mahmudah)</p>
    </header>

    <section className="grid md:grid-cols-2 gap-6">
      <div className="bg-blue-50 p-6 rounded-xl border border-blue-100">
        <h3 className="font-bold text-xl text-blue-800 mb-3">Apa itu Jujur?</h3>
        <p className="text-gray-700 leading-relaxed">
          Dalam bahasa Arab, jujur disebut <strong>Ash-Shidqu</strong> atau <strong>Shiddiq</strong> yang berarti nyata atau benar. 
          Secara istilah, jujur adalah kesesuaian antara ucapan dan perbuatan, 
          kesesuaian antara informasi dan kenyataan, serta ketegasan dan kemantapan hati.
        </p>
      </div>
      <div className="bg-orange-50 p-6 rounded-xl border border-orange-100 flex flex-col justify-center items-center text-center">
        <span className="text-4xl mb-2">ğŸ—£ï¸ = ğŸ¤²</span>
        <p className="font-medium text-orange-800">"Katakanlah yang benar walau itu pahit."</p>
      </div>
    </section>

    <section className="bg-emerald-50 p-6 rounded-xl border border-emerald-100">
      <h3 className="font-bold text-xl text-emerald-800 mb-4 border-b border-emerald-200 pb-2">Dalil Naqli</h3>
      <div className="text-right font-serif text-3xl leading-loose mb-4 text-gray-800">
        ÙŠÙÙ°Ù“Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ù±Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¡ÙØ§Ù…ÙÙ†ÙÙˆØ§Ù’ Ù±ØªÙ‘ÙÙ‚ÙÙˆØ§Ù’ Ù±Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙÙƒÙÙˆÙ†ÙÙˆØ§Ù’ Ù…ÙØ¹Ù Ù±Ù„ØµÙ‘ÙÙ°Ø¯ÙÙ‚ÙÙŠÙ†Ù
      </div>
      <div className="text-gray-700 italic mb-2">
        "Hai orang-orang yang beriman, bertakwalah kepada Allah, dan hendaklah kamu bersama orang-orang yang benar."
      </div>
      <div className="text-sm font-semibold text-emerald-700">(Q.S. At-Taubah: 119)</div>
    </section>

    <section>
      <h3 className="font-bold text-xl text-gray-800 mb-4">Macam-Macam Kejujuran</h3>
      <div className="grid md:grid-cols-3 gap-4">
        {[
          { title: "Jujur dalam Niat", desc: "Melakukan segala sesuatu ikhlas hanya karena Allah SWT." },
          { title: "Jujur dalam Ucapan", desc: "Memberitakan sesuatu sesuai dengan realita yang terjadi." },
          { title: "Jujur dalam Perbuatan", desc: "Beramal dengan sungguh-sungguh sesuai dengan apa yang ada dalam batinnya." }
        ].map((item, idx) => (
          <div key={idx} className="p-4 bg-white border shadow-sm rounded-lg hover:border-emerald-500 transition-colors">
            <div className="font-bold text-emerald-600 mb-2">{item.title}</div>
            <p className="text-sm text-gray-600">{item.desc}</p>
          </div>
        ))}
      </div>
    </section>
  </div>
);

const MateriAmanah = () => (
  <div className="space-y-8 animate-fadeIn">
    <header className="border-b pb-4 border-gray-200">
      <h2 className="text-3xl font-bold text-emerald-800">Perilaku Amanah</h2>
      <p className="text-gray-500 mt-1">Menjaga kepercayaan adalah kunci kemuliaan</p>
    </header>

    <section className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-6 rounded-xl shadow-lg">
      <h3 className="font-bold text-xl mb-3">Definisi Amanah</h3>
      <p className="leading-relaxed text-emerald-50">
        Amanah secara bahasa berarti <strong>terpercaya</strong> (dapat dipercaya). 
        Secara istilah, amanah bermakna titipan yang wajib disampaikan kepada orang yang berhak menerimanya. 
        Amanah adalah lawan kata dari <em>Khianat</em>.
      </p>
    </section>

    <section className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
      <h3 className="font-bold text-xl text-emerald-800 mb-4 border-b pb-2">Dalil Naqli</h3>
      <div className="text-right font-serif text-2xl leading-loose mb-4 text-gray-800">
        ÙŠÙÙ°Ù“Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ù±Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¡ÙØ§Ù…ÙÙ†ÙÙˆØ§Ù’ Ù„ÙØ§ ØªÙØ®ÙÙˆÙ†ÙÙˆØ§Ù’ Ù±Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙÙ±Ù„Ø±Ù‘ÙØ³ÙÙˆÙ„Ù ÙˆÙØªÙØ®ÙÙˆÙ†ÙÙˆÙ“Ø§Ù’ Ø£ÙÙ…ÙÙ°Ù†ÙÙ°ØªÙÙƒÙÙ…Ù’ ÙˆÙØ£ÙÙ†ØªÙÙ…Ù’ ØªÙØ¹Ù’Ù„ÙÙ…ÙÙˆÙ†Ù
      </div>
      <div className="text-gray-700 italic mb-2">
        "Hai orang-orang yang beriman, janganlah kamu mengkhianati Allah dan Rasul (Muhammad) dan (juga) janganlah kamu mengkhianati amanat-amanat yang dipercayakan kepadamu, sedang kamu mengetahui."
      </div>
      <div className="text-sm font-semibold text-emerald-700">(Q.S. Al-Anfal: 27)</div>
    </section>

    <section>
      <h3 className="font-bold text-xl text-gray-800 mb-4">3 Bentuk Amanah</h3>
      <div className="space-y-4">
        <DetailCard 
          icon="ğŸ•Œ" 
          title="Amanah terhadap Allah SWT" 
          desc="Melaksanakan semua perintah-Nya dan menjauhi larangan-Nya." 
          example="Contoh: Shalat 5 waktu, Puasa Ramadhan."
        />
        <DetailCard 
          icon="ğŸ¤" 
          title="Amanah terhadap Sesama Manusia" 
          desc="Menjaga hak-hak antar sesama manusia." 
          example="Contoh: Menjaga barang titipan, tidak curang dalam timbangan, menjaga rahasia teman."
        />
        <DetailCard 
          icon="ğŸ‘¤" 
          title="Amanah terhadap Diri Sendiri" 
          desc="Memelihara dan menggunakan segenap kemampuan demi kebaikan diri." 
          example="Contoh: Menjaga kesehatan, belajar dengan rajin."
        />
      </div>
    </section>
  </div>
);

const DetailCard = ({ icon, title, desc, example }) => (
  <div className="flex gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
    <div className="text-3xl bg-white w-12 h-12 flex items-center justify-center rounded-full shadow-sm">{icon}</div>
    <div>
      <h4 className="font-bold text-gray-800">{title}</h4>
      <p className="text-gray-600 text-sm mt-1">{desc}</p>
      <p className="text-emerald-600 text-xs font-semibold mt-2 bg-emerald-50 inline-block px-2 py-1 rounded">{example}</p>
    </div>
  </div>
);

const StudiKasus = () => {
  const [scenario, setScenario] = useState(0);
  const [feedback, setFeedback] = useState(null);

  const scenarios = [
    {
      id: 1,
      title: "Ujian Matematika",
      story: "Budi sedang mengerjakan ujian matematika. Soalnya sangat sulit dan dia tidak bisa menjawabnya. Temannya, Andi, menawarkan jawaban melalui kertas kecil.",
      question: "Apa yang harus dilakukan Budi?",
      options: [
        { text: "Menerima kertas jawaban agar nilainya bagus.", correct: false, feedback: "Ini adalah perilaku curang (tidak jujur). Nilai bagus tidak berkah jika didapat dengan cara salah." },
        { text: "Menolak dengan halus dan mengerjakan semampunya.", correct: true, feedback: "Tepat! Kejujuran lebih utama daripada nilai. Allah melihat usahamu, bukan hasil curangmu." }
      ]
    },
    {
      id: 2,
      title: "Menemukan Dompet",
      story: "Saat pulang sekolah, Siti menemukan dompet berisi uang Rp 500.000 di jalan sepi. Tidak ada orang yang melihatnya.",
      question: "Tindakan mana yang mencerminkan amanah?",
      options: [
        { text: "Mengambil uangnya untuk jajan, lalu membuang dompetnya.", correct: false, feedback: "Ini adalah pengkhianatan amanah. Barang temuan (Luqathah) wajib diumumkan atau dikembalikan." },
        { text: "Melaporkan ke guru atau polisi, atau mencari identitas pemilik di dalam dompet.", correct: true, feedback: "Luar biasa! Ini adalah sikap Amanah terhadap sesama manusia." }
      ]
    }
  ];

  const handleChoice = (option) => {
    setFeedback({
      isCorrect: option.correct,
      message: option.feedback
    });
  };

  const nextScenario = () => {
    setFeedback(null);
    if (scenario < scenarios.length - 1) {
      setScenario(scenario + 1);
    } else {
      // Reset logic or finish
      alert("Studi kasus selesai! Silakan lanjut ke Kuis.");
    }
  };

  const current = scenarios[scenario];

  return (
    <div className="space-y-6 animate-fadeIn">
      <header className="border-b pb-4 border-gray-200 flex justify-between items-center">
        <h2 className="text-3xl font-bold text-emerald-800">Studi Kasus</h2>
        <span className="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-sm font-semibold">
          Kasus {scenario + 1} / {scenarios.length}
        </span>
      </header>

      <div className="bg-white border-2 border-emerald-100 rounded-2xl overflow-hidden shadow-sm">
        <div className="bg-emerald-50 p-6 border-b border-emerald-100">
          <h3 className="font-bold text-xl mb-2 flex items-center gap-2">
            <HelpCircle className="text-emerald-600" />
            {current.title}
          </h3>
          <p className="text-gray-700 text-lg leading-relaxed">{current.story}</p>
        </div>
        
        <div className="p-6">
          <p className="font-bold text-gray-800 mb-4">{current.question}</p>
          
          {!feedback ? (
            <div className="grid gap-3">
              {current.options.map((opt, idx) => (
                <button 
                  key={idx}
                  onClick={() => handleChoice(opt)}
                  className="w-full text-left p-4 rounded-xl border border-gray-200 hover:border-emerald-500 hover:bg-emerald-50 transition-all font-medium text-gray-700"
                >
                  {opt.text}
                </button>
              ))}
            </div>
          ) : (
            <div className={`p-6 rounded-xl text-center ${feedback.isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}>
              <div className="mb-3 flex justify-center">
                {feedback.isCorrect ? <CheckCircle size={48} className="text-green-500" /> : <XCircle size={48} className="text-red-500" />}
              </div>
              <h4 className={`text-lg font-bold mb-2 ${feedback.isCorrect ? 'text-green-800' : 'text-red-800'}`}>
                {feedback.isCorrect ? "Jawaban Benar!" : "Kurang Tepat"}
              </h4>
              <p className="text-gray-700 mb-6">{feedback.message}</p>
              
              {scenario < scenarios.length - 1 ? (
                 <button onClick={nextScenario} className="px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-semibold">
                   Kasus Berikutnya
                 </button>
              ) : (
                <p className="text-sm font-semibold text-emerald-600">Selamat! Anda telah menyelesaikan studi kasus.</p>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

const Kuis = () => {
  const [currentQ, setCurrentQ] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);

  const questions = [
    {
      q: "Arti lafal 'Ash-Shidqu' adalah...",
      options: ["Bohong", "Khianat", "Benar/Jujur", "Ingkar Janji"],
      ans: 2
    },
    {
      q: "Di bawah ini yang termasuk contoh Amanah kepada Allah SWT adalah...",
      options: ["Menjaga kesehatan tubuh", "Menjalankan shalat 5 waktu", "Mengembalikan buku teman", "Tidak menyontek saat ujian"],
      ans: 1
    },
    {
      q: "Dalil tentang perintah berlaku jujur terdapat dalam...",
      options: ["Q.S. Al-Anfal: 27", "Q.S. At-Taubah: 119", "Q.S. Al-Baqarah: 183", "Q.S. Al-Maidah: 3"],
      ans: 1
    },
    {
      q: "Lawan kata dari sifat Amanah adalah...",
      options: ["Kizib", "Khianat", "Fatonah", "Tabligh"],
      ans: 1
    },
    {
      q: "Fulan meminjam pensil temannya, namun pensil itu hilang. Sikap amanah yang harus dilakukan Fulan adalah...",
      options: ["Diam saja agar tidak ketahuan", "Menuduh orang lain mengambilnya", "Meminta maaf dan menggantinya", "Marah-marah kepada pemilik pensil"],
      ans: 2
    }
  ];

  const handleAnswer = (idx) => {
    setSelectedAnswer(idx);
    if (idx === questions[currentQ].ans) {
      setScore(score + 1);
    }
    
    setTimeout(() => {
      if (currentQ < questions.length - 1) {
        setCurrentQ(currentQ + 1);
        setSelectedAnswer(null);
      } else {
        setShowResult(true);
      }
    }, 800);
  };

  const resetQuiz = () => {
    setScore(0);
    setCurrentQ(0);
    setShowResult(false);
    setSelectedAnswer(null);
  };

  if (showResult) {
    return (
      <div className="text-center py-10 animate-fadeIn">
        <h2 className="text-3xl font-bold text-gray-800 mb-6">Hasil Kuis</h2>
        <div className="w-40 h-40 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6 relative">
            <span className="text-5xl font-bold text-emerald-700">{score * 20}</span>
            <div className="absolute -bottom-2 bg-emerald-600 text-white text-xs px-3 py-1 rounded-full">Skor Akhir</div>
        </div>
        
        <p className="text-lg text-gray-600 mb-8">
          {score === 5 ? "Masya Allah! Kamu hebat sekali!" : score >= 3 ? "Bagus! Terus tingkatkan belajarmu." : "Jangan menyerah, baca materi lagi ya!"}
        </p>

        <button onClick={resetQuiz} className="px-8 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-semibold shadow-md transition-transform hover:-translate-y-1">
          Ulangi Kuis
        </button>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto space-y-8 animate-fadeIn">
       <header className="border-b pb-4 border-gray-200 flex justify-between items-end">
        <div>
           <h2 className="text-2xl font-bold text-emerald-800">Kuis Evaluasi</h2>
           <p className="text-sm text-gray-500">Pilihlah jawaban yang paling tepat.</p>
        </div>
        <div className="text-xl font-bold text-gray-400">
          <span className="text-emerald-600">{currentQ + 1}</span> / {questions.length}
        </div>
      </header>

      <div className="bg-white p-6 rounded-xl shadow-sm border border-emerald-50">
        <h3 className="text-xl font-medium text-gray-800 mb-8 leading-relaxed">
          {questions[currentQ].q}
        </h3>

        <div className="space-y-3">
          {questions[currentQ].options.map((opt, idx) => (
            <button
              key={idx}
              onClick={() => handleAnswer(idx)}
              disabled={selectedAnswer !== null}
              className={`w-full text-left p-4 rounded-lg border transition-all duration-200 
                ${selectedAnswer === idx 
                  ? idx === questions[currentQ].ans 
                    ? 'bg-green-100 border-green-500 text-green-800' 
                    : 'bg-red-100 border-red-500 text-red-800'
                  : 'border-gray-200 hover:bg-emerald-50 hover:border-emerald-300'
                }
              `}
            >
              <div className="flex items-center gap-3">
                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold border
                  ${selectedAnswer === idx ? 'border-transparent bg-white bg-opacity-50' : 'bg-gray-100 border-gray-300 text-gray-500'}
                `}>
                  {String.fromCharCode(65 + idx)}
                </div>
                {opt}
              </div>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

export default App;
